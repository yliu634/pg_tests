-- PostgreSQL compatible tests from inverted_index_geospatial
--
-- CockroachDB uses inverted geospatial indexes; PostgreSQL/PostGIS uses GiST.

SET client_min_messages = warning;

CREATE EXTENSION IF NOT EXISTS postgis;

DROP TABLE IF EXISTS geo_table;

CREATE TABLE geo_table(
  k INT PRIMARY KEY,
  geom geometry
);
CREATE INDEX geo_table_geom_gist ON geo_table USING GIST (geom);

INSERT INTO geo_table VALUES
  (1, ST_GeomFromEWKT('SRID=26918;POINT(400001 4000001)')),
  (2, ST_GeomFromEWKT('SRID=26918;LINESTRING(400001 4000001, 400002 4000002)')),
  (3, ST_GeomFromEWKT('SRID=26918;POINT(400003 4000003)')),
  (4, ST_GeomFromEWKT('SRID=26918;LINESTRING(400004 4000004, 400005 4000005)')),
  (5, ST_GeomFromEWKT('SRID=26918;LINESTRING(400040 4000040, 400041 4000041)')),
  (6, ST_GeomFromEWKT('SRID=26918;POLYGON((400001 4000001, 400005 4000001, 400005 4000005, 400001 4000005, 400001 4000001))'));

SELECT k
FROM geo_table
WHERE ST_Intersects(ST_GeomFromEWKT('SRID=26918;POINT(400003 4000003)'), geom)
ORDER BY k;

DROP TABLE geo_table;

CREATE TABLE geo_table(
  k INT PRIMARY KEY,
  geom geometry(geometry, 26918)
);
CREATE INDEX geo_table_geom_gist2 ON geo_table USING GIST (geom);

INSERT INTO geo_table VALUES
  (1, ST_GeomFromEWKT('SRID=26918;POINT(400001 4000001)')),
  (2, ST_GeomFromEWKT('SRID=26918;LINESTRING(400001 4000001, 400002 4000002)')),
  (3, ST_GeomFromEWKT('SRID=26918;POINT(400003 4000003)')),
  (4, ST_GeomFromEWKT('SRID=26918;LINESTRING(400004 4000004, 400005 4000005)')),
  (5, ST_GeomFromEWKT('SRID=26918;LINESTRING(400040 4000040, 400041 4000041)')),
  (6, ST_GeomFromEWKT('SRID=26918;POLYGON((400001 4000001, 400005 4000001, 400005 4000005, 400001 4000005, 400001 4000001))'));

SELECT k
FROM geo_table
WHERE ST_Intersects(ST_GeomFromEWKT('SRID=26918;POINT(400003 4000003)'), geom)
ORDER BY k;

DROP TABLE geo_table;

RESET client_min_messages;
